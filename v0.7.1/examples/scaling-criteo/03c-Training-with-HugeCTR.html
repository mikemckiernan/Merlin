
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Scaling Criteo: Training with HugeCTR &#8212; Merlin  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://nvidia-merlin.github.io/Merlin/main/examples/scaling-criteo/03c-Training-with-HugeCTR.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Merlin  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Merlin
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../README.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../index.html">
   Example Notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../getting-started-movielens/index.html">
     Getting Started using the MovieLens Dataset
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/01-Download-Convert.html">
       MovieLens Download and Convert
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/02-ETL-with-NVTabular.html">
       Feature Engineering with NVTabular
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/03-Training-with-HugeCTR.html">
       Training with HugeCTR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/03-Training-with-TF.html">
       Training with TensorFlow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/03-Training-with-PyTorch.html">
       Training with PyTorch
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/04-Triton-Inference-with-HugeCTR.html">
       Serving the HugeCTR Model with Triton
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/04-Triton-Inference-with-TF.html">
       Serving the TensorFlow Model with Triton
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Building-and-deploying-multi-stage-RecSys/index.html">
     Deploying a Multi-Stage Recommender System
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Building-and-deploying-multi-stage-RecSys/01-Building-Recommender-Systems-with-Merlin.html">
       Building the Recommender System
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Building-and-deploying-multi-stage-RecSys/02-Deploying-multi-stage-RecSys-with-Merlin-Systems.html">
       Deploying the Recommender System with Triton
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="index.html">
     Scaling Large Datasets with Criteo
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="01-Download-Convert.html">
       Criteo Download and Convert
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="02-ETL-with-NVTabular.html">
       Feature Engineering with NVTabular
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="03-Training-with-FastAI.html">
       Training with FastAI
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="03-Training-with-HugeCTR.html">
       Training with HugeCTR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="03-Training-with-TF.html">
       Training with TensorFlow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="04-Triton-Inference-with-HugeCTR.html">
       Serving the HugeCTR Model with Triton
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="04-Triton-Inference-with-TF.html">
       Serving the TensorFlow Model with Triton
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../containers.html">
   Merlin Containers
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../support_matrix/index.html">
   Merlin Support Matrix
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../support_matrix/support_matrix_merlin_training.html">
     Merlin Training Support Matrix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../support_matrix/support_matrix_merlin_tensorflow_training.html">
     Merlin TensorFlow Training Support Matrix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../support_matrix/support_matrix_merlin_pytorch_training.html">
     Merlin PyTorch Training Support Training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../support_matrix/support_matrix_merlin_inference.html">
     Merlin Inference Support Matrix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../support_matrix/support_matrix_merlin_tensorflow_inference.html">
     Merlin TensorFlow Inference Support Matrix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../support_matrix/support_matrix_merlin_pytorch_inference.html">
     Merlin PyTorch Inference Support Matrix
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-objectives">
     Learning objectives
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started">
   Getting Started
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Scaling Criteo: Training with HugeCTR</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-objectives">
     Learning objectives
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started">
   Getting Started
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright 2021 NVIDIA Corporation. All Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1"># ==============================================================================</span>
</pre></div>
</div>
</div>
</div>
<section id="scaling-criteo-training-with-hugectr">
<h1>Scaling Criteo: Training with HugeCTR<a class="headerlink" href="#scaling-criteo-training-with-hugectr" title="Permalink to this headline">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">#</a></h2>
<p>HugeCTR is an open-source framework to accelerate the training of CTR estimation models on NVIDIA GPUs. It is written in CUDA C++ and highly exploits GPU-accelerated libraries such as cuBLAS, cuDNN, and NCCL.<br><br>
HugeCTR offers multiple advantages to train deep learning recommender systems:</p>
<ol class="arabic simple">
<li><p><strong>Speed</strong>: HugeCTR is a highly efficient framework written C++. We experienced upto 10x speed up. HugeCTR on a NVIDIA DGX A100 system proved to be the fastest commercially available solution for training the architecture Deep Learning Recommender Model (DLRM) developed by Facebook.</p></li>
<li><p><strong>Scale</strong>: HugeCTR supports model parallel scaling. It distributes the large embedding tables over multiple GPUs or multiple nodes.</p></li>
<li><p><strong>Easy-to-use</strong>: Easy-to-use Python API similar to Keras. Examples for popular deep learning recommender systems architectures (Wide&amp;Deep, DLRM, DCN, DeepFM) are available.</p></li>
</ol>
<p>HugeCTR is able to train recommender system models with larger-than-memory embedding tables by leveraging a parameter server.</p>
<p>You can find more information about HugeCTR <a class="reference external" href="https://github.com/NVIDIA/HugeCTR">here</a>.</p>
<section id="learning-objectives">
<h3>Learning objectives<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">#</a></h3>
<p>In this notebook, we learn how to to use HugeCTR for training recommender system models</p>
<ul class="simple">
<li><p>Use <strong>HugeCTR</strong> to define a recommender system model</p></li>
<li><p>Train Facebook’s <a class="reference external" href="https://arxiv.org/pdf/1906.00091.pdf">Deep Learning Recommendation Model</a> with HugeCTR</p></li>
</ul>
</section>
</section>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">#</a></h2>
<p>As HugeCTR optimizes the training in CUDA++, we need to define the training pipeline and model architecture and execute it via the commandline. We will use the Python API, which is similar to Keras models.</p>
<p>If you are not familiar with HugeCTR’s Python API and parameters, you can read more in its GitHub repository:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/NVIDIA/HugeCTR/blob/master/docs/hugectr_user_guide.md">HugeCTR User Guide</a></p></li>
<li><p><a class="reference external" href="https://github.com/NVIDIA/HugeCTR/blob/master/docs/python_interface.md">HugeCTR Python API</a></p></li>
<li><p><a class="reference external" href="https://github.com/NVIDIA/HugeCTR/blob/master/docs/configuration_file_setup.md">HugeCTR Configuration File</a></p></li>
<li><p><a class="reference external" href="https://github.com/NVIDIA/HugeCTR/tree/master/samples">HugeCTR example architectures</a></p></li>
</ul>
<p>We will write the code to a <code class="docutils literal notranslate"><span class="pre">./model.py</span></code> file and execute it. It will create snapshot, which we will use for inference in the next notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> &#39;./model.py&#39;

<span class="kn">import</span> <span class="nn">hugectr</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>  <span class="c1"># noqa</span>

<span class="c1"># HugeCTR</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">solver_parser_helper</span><span class="p">(</span>
    <span class="n">vvgpu</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">max_eval_batches</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">batchsize_eval</span><span class="o">=</span><span class="mi">2720</span><span class="p">,</span>
    <span class="n">batchsize</span><span class="o">=</span><span class="mi">2720</span><span class="p">,</span>
    <span class="n">display</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">eval_interval</span><span class="o">=</span><span class="mi">3200</span><span class="p">,</span>
    <span class="n">snapshot</span><span class="o">=</span><span class="mi">3200</span><span class="p">,</span>
    <span class="n">i64_input_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">use_mixed_precision</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">repeat_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">CreateOptimizer</span><span class="p">(</span>
    <span class="n">optimizer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Optimizer_t</span><span class="o">.</span><span class="n">SGD</span><span class="p">,</span> <span class="n">use_mixed_precision</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">hugectr</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span>
        <span class="n">data_reader_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderType_t</span><span class="o">.</span><span class="n">Parquet</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="s2">&quot;/raid/data/criteo/test_dask/output/train/_file_list.txt&quot;</span><span class="p">,</span>
        <span class="n">eval_source</span><span class="o">=</span><span class="s2">&quot;/raid/data/criteo/test_dask/output/valid/_file_list.txt&quot;</span><span class="p">,</span>
        <span class="n">check_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Check_t</span><span class="o">.</span><span class="n">Non</span><span class="p">,</span>
        <span class="n">label_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">label_name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="n">dense_dim</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span>
        <span class="n">dense_name</span><span class="o">=</span><span class="s2">&quot;dense&quot;</span><span class="p">,</span>
        <span class="n">slot_size_array</span><span class="o">=</span><span class="p">[</span>
            <span class="mi">10000000</span><span class="p">,</span>
            <span class="mi">10000000</span><span class="p">,</span>
            <span class="mi">3014529</span><span class="p">,</span>
            <span class="mi">400781</span><span class="p">,</span>
            <span class="mi">11</span><span class="p">,</span>
            <span class="mi">2209</span><span class="p">,</span>
            <span class="mi">11869</span><span class="p">,</span>
            <span class="mi">148</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">,</span>
            <span class="mi">977</span><span class="p">,</span>
            <span class="mi">15</span><span class="p">,</span>
            <span class="mi">38713</span><span class="p">,</span>
            <span class="mi">10000000</span><span class="p">,</span>
            <span class="mi">10000000</span><span class="p">,</span>
            <span class="mi">10000000</span><span class="p">,</span>
            <span class="mi">584616</span><span class="p">,</span>
            <span class="mi">12883</span><span class="p">,</span>
            <span class="mi">109</span><span class="p">,</span>
            <span class="mi">37</span><span class="p">,</span>
            <span class="mi">17177</span><span class="p">,</span>
            <span class="mi">7425</span><span class="p">,</span>
            <span class="mi">20266</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">,</span>
            <span class="mi">7085</span><span class="p">,</span>
            <span class="mi">1535</span><span class="p">,</span>
            <span class="mi">64</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">data_reader_sparse_param_array</span><span class="o">=</span><span class="p">[</span>
            <span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderSparseParam</span><span class="p">(</span><span class="n">hugectr</span><span class="o">.</span><span class="n">DataReaderSparse_t</span><span class="o">.</span><span class="n">Localized</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">sparse_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;data1&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">SparseEmbedding</span><span class="p">(</span>
        <span class="n">embedding_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Embedding_t</span><span class="o">.</span><span class="n">LocalizedSlotSparseEmbeddingHash</span><span class="p">,</span>
        <span class="n">max_vocabulary_size_per_gpu</span><span class="o">=</span><span class="mi">15500000</span><span class="p">,</span>
        <span class="n">embedding_vec_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">combiner</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">sparse_embedding_name</span><span class="o">=</span><span class="s2">&quot;sparse_embedding1&quot;</span><span class="p">,</span>
        <span class="n">bottom_name</span><span class="o">=</span><span class="s2">&quot;data1&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dense&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc1&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc1&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu1&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc2&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc2&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu2&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu2&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc3&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc3&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu3&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">Interaction</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu3&quot;</span><span class="p">,</span> <span class="s2">&quot;sparse_embedding1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;interaction1&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;interaction1&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc4&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc4&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu4&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu4&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc5&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc5&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu5&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu5&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc6&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc6&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu6&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu6&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc7&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span><span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc7&quot;</span><span class="p">],</span> <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu7&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">InnerProduct</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;relu7&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc8&quot;</span><span class="p">],</span>
        <span class="n">num_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">hugectr</span><span class="o">.</span><span class="n">DenseLayer</span><span class="p">(</span>
        <span class="n">layer_type</span><span class="o">=</span><span class="n">hugectr</span><span class="o">.</span><span class="n">Layer_t</span><span class="o">.</span><span class="n">BinaryCrossEntropyLoss</span><span class="p">,</span>
        <span class="n">bottom_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fc8&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">],</span>
        <span class="n">top_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting ./model.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>model.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===================================Model Init====================================
[29d14h45m11s][HUGECTR][INFO]: Global seed is 2284029516
[29d14h45m13s][HUGECTR][INFO]: Peer-to-peer access cannot be fully enabled.
Device 0: Tesla V100-SXM2-32GB
[29d14h45m13s][HUGECTR][INFO]: num of DataReader workers: 1
[29d14h45m13s][HUGECTR][INFO]: num_internal_buffers 1
[29d14h45m13s][HUGECTR][INFO]: num_internal_buffers 1
[29d14h45m13s][HUGECTR][INFO]: Vocabulary size: 54120457
[29d14h45m13s][HUGECTR][INFO]: max_vocabulary_size_per_gpu_=15500000
[29d14h45m13s][HUGECTR][INFO]: All2All Warmup Start
[29d14h45m13s][HUGECTR][INFO]: All2All Warmup End
[29d14h45m27s][HUGECTR][INFO]: gpu0 start to init embedding
[29d14h45m27s][HUGECTR][INFO]: gpu0 init embedding done
==================================Model Summary==================================
Label Name                    Dense Name                    Sparse Name                   
label                         dense                         data1                         
--------------------------------------------------------------------------------
Layer Type                    Input Name                    Output Name                   
--------------------------------------------------------------------------------
LocalizedHash                 data1                         sparse_embedding1             
InnerProduct                  dense                         fc1                           
ReLU                          fc1                           relu1                         
InnerProduct                  relu1                         fc2                           
ReLU                          fc2                           relu2                         
InnerProduct                  relu2                         fc3                           
ReLU                          fc3                           relu3                         
Interaction                   relu3, sparse_embedding1      interaction1                  
InnerProduct                  interaction1                  fc4                           
ReLU                          fc4                           relu4                         
InnerProduct                  relu4                         fc5                           
ReLU                          fc5                           relu5                         
InnerProduct                  relu5                         fc6                           
ReLU                          fc6                           relu6                         
InnerProduct                  relu6                         fc7                           
ReLU                          fc7                           relu7                         
InnerProduct                  relu7                         fc8                           
BinaryCrossEntropyLoss        fc8, label                    loss                          
--------------------------------------------------------------------------------
=====================================Model Fit====================================
[29d14h45m27s][HUGECTR][INFO]: Use non-epoch mode with number of iterations: 10000
[29d14h45m27s][HUGECTR][INFO]: Training batchsize: 2720, evaluation batchsize: 2720
[29d14h45m27s][HUGECTR][INFO]: Evaluation interval: 3200, snapshot interval: 3200
[29d14h45m33s][HUGECTR][INFO]: Iter: 1000 Time(1000 iters): 5.641792s Loss: 0.164940 lr:0.001000
[29d14h45m39s][HUGECTR][INFO]: Iter: 2000 Time(1000 iters): 5.656664s Loss: 0.135722 lr:0.001000
[29d14h45m44s][HUGECTR][INFO]: Iter: 3000 Time(1000 iters): 5.651847s Loss: 0.160054 lr:0.001000
[29d14h45m46s][HUGECTR][INFO]: Evaluation, AUC: 0.552071
[29d14h45m46s][HUGECTR][INFO]: Eval Time for 100 iters: 0.285196s
[29d14h45m47s][HUGECTR][INFO]: Rank0: Dump hash table from GPU0
[29d14h45m48s][HUGECTR][INFO]: Rank0: Write hash table &lt;key,slot_id,value&gt; pairs to file
[29d14h45m49s][HUGECTR][INFO]: Done
[29d14h45m56s][HUGECTR][INFO]: Iter: 4000 Time(1000 iters): 11.744939s Loss: 0.143607 lr:0.001000
[29d14h46m20s][HUGECTR][INFO]: Iter: 5000 Time(1000 iters): 5.678187s Loss: 0.129964 lr:0.001000
[29d14h46m70s][HUGECTR][INFO]: Iter: 6000 Time(1000 iters): 5.678660s Loss: 0.134518 lr:0.001000
[29d14h46m10s][HUGECTR][INFO]: Evaluation, AUC: 0.612846
[29d14h46m10s][HUGECTR][INFO]: Eval Time for 100 iters: 0.218399s
[29d14h46m12s][HUGECTR][INFO]: Rank0: Dump hash table from GPU0
[29d14h46m14s][HUGECTR][INFO]: Rank0: Write hash table &lt;key,slot_id,value&gt; pairs to file
[29d14h46m15s][HUGECTR][INFO]: Done
[29d14h46m23s][HUGECTR][INFO]: Iter: 7000 Time(1000 iters): 15.466943s Loss: 0.131755 lr:0.001000
[29d14h46m29s][HUGECTR][INFO]: Iter: 8000 Time(1000 iters): 5.657035s Loss: 0.136876 lr:0.001000
[29d14h46m34s][HUGECTR][INFO]: Iter: 9000 Time(1000 iters): 5.659428s Loss: 0.141471 lr:0.001000
[29d14h46m38s][HUGECTR][INFO]: Evaluation, AUC: 0.635054
[29d14h46m38s][HUGECTR][INFO]: Eval Time for 100 iters: 0.192339s
[29d14h46m40s][HUGECTR][INFO]: Rank0: Dump hash table from GPU0
[29d14h46m43s][HUGECTR][INFO]: Rank0: Write hash table &lt;key,slot_id,value&gt; pairs to file
[29d14h46m45s][HUGECTR][INFO]: Done
</pre></div>
</div>
</div>
</div>
<p>We trained the model and created snapshots.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By NVIDIA<br/>
  
      &copy; Copyright 2022, NVIDIA.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>