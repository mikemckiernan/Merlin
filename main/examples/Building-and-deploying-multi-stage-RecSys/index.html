
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Deploying a Multi-Stage Recommender System &#8212; Merlin  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="canonical" href="https://nvidia-merlin.github.io/Merlin/main/examples/Building-and-deploying-multi-stage-RecSys/index.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Building Intelligent Recommender Systems with Merlin" href="01-Building-Recommender-Systems-with-Merlin.html" />
    <link rel="prev" title="Serve Recommendations from the TensorFlow Model" href="../getting-started-movielens/04-Triton-Inference-with-TF.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Merlin  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    About Merlin
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../help-me-choose.html">
   Choosing the Right Model
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Example Notebooks
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../getting-started-movielens/index.html">
     Getting Started using the MovieLens Dataset
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/01-Download-Convert.html">
       MovieLens Download and Convert
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/02-ETL-with-NVTabular.html">
       Feature Engineering with NVTabular
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/03-Training-with-HugeCTR.html">
       Training with HugeCTR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/03-Training-with-TF.html">
       Training with TensorFlow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/03-Training-with-PyTorch.html">
       Training with PyTorch
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/04-Triton-Inference-with-HugeCTR.html">
       Serving the HugeCTR Model with Triton
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../getting-started-movielens/04-Triton-Inference-with-TF.html">
       Serving the TensorFlow Model with Triton
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="current reference internal" href="#">
     Deploying a Multi-Stage Recommender System
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="01-Building-Recommender-Systems-with-Merlin.html">
       Building the Recommender System
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="02-Deploying-multi-stage-RecSys-with-Merlin-Systems.html">
       Deploying the Recommender System with Triton
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../sagemaker-tensorflow/index.html">
     Merlin and AWS SageMaker
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../sagemaker-tensorflow/sagemaker-merlin-tensorflow.html">
       Training and Serving Merlin on AWS SageMaker
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../scaling-criteo/index.html">
     Scaling Large Datasets with Criteo
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../scaling-criteo/01-Download-Convert.html">
       Criteo Download and Convert
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../scaling-criteo/02-ETL-with-NVTabular.html">
       Feature Engineering with NVTabular
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../scaling-criteo/03-Training-with-HugeCTR.html">
       Training with HugeCTR
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../scaling-criteo/03-Training-with-Merlin-Models-TensorFlow.html">
       Training with Merlin Models and TensorFlow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../scaling-criteo/04-Triton-Inference-with-HugeCTR.html">
       Deploy the HugeCTR Model with Triton
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../scaling-criteo/04-Triton-Inference-with-Merlin-Models-TensorFlow.html">
       Deploy the TensorFlow Model with Triton
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../containers.html">
   Merlin Containers
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../support_matrix/index.html">
   Merlin Support Matrix
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../support_matrix/support_matrix_merlin_hugectr.html">
     Merlin HugeCTR Support Matrix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../support_matrix/support_matrix_merlin_tensorflow.html">
     Merlin TensorFlow Support Matrix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../support_matrix/support_matrix_merlin_pytorch.html">
     Merlin PyTorch Support Matrix
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-example-notebooks">
   Running the Example Notebooks
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Deploying a Multi-Stage Recommender System</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-example-notebooks">
   Running the Example Notebooks
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="deploying-a-multi-stage-recommender-system">
<h1>Deploying a Multi-Stage Recommender System<a class="headerlink" href="#deploying-a-multi-stage-recommender-system" title="Permalink to this headline">#</a></h1>
<p>We created two Jupyter notebooks that demonstrate two different stages of recommender systems.
The notebooks show how to deploy a multi-stage recommender system and serve recommendations with Triton Inference Server.
The notebooks demonstrate how to use the NVTabular, Merlin Models, and Merlin Systems libraries for feature engineering, training, and then inference.</p>
<p>The two example notebooks are structured as follows:</p>
<ul class="simple">
<li><p><a class="reference internal" href="01-Building-Recommender-Systems-with-Merlin.html"><span class="doc std std-doc">Building the Recommender System</span></a>:</p>
<ul>
<li><p>Execute the preprocessing and feature engineering pipeline (ETL) with NVTabular on the GPU/CPU.</p></li>
<li><p>Train a ranking and retrieval model with TensorFlow based on the ETL output.</p></li>
<li><p>Export the saved models, user and item features, and item embeddings.</p></li>
</ul>
</li>
<li><p><a class="reference internal" href="02-Deploying-multi-stage-RecSys-with-Merlin-Systems.html"><span class="doc std std-doc">Deploying the Recommender System with Triton</span></a>:</p>
<ul>
<li><p>Set up a Feast feature store for feature storing and a Faiss index for similarity search.</p></li>
<li><p>Build a multi-stage recommender system ensemble pipeline with Merlin Systems operators.</p></li>
<li><p>Perform inference with the Triton Inference Server using the Merlin Systems library.</p></li>
</ul>
</li>
</ul>
<section id="running-the-example-notebooks">
<h2>Running the Example Notebooks<a class="headerlink" href="#running-the-example-notebooks" title="Permalink to this headline">#</a></h2>
<p>Containers with the Merlin libraries are available from the NVIDIA NGC catalog.
To run the sample notebooks, use the <code class="docutils literal notranslate"><span class="pre">merlin-tensorflow</span></code> container.</p>
<p>You can pull and run the <code class="docutils literal notranslate"><span class="pre">nvcr.io/nvidia/merlin/merlin-tensorflow:nightly</span></code> container.</p>
<blockquote>
<div><p>In production, instead of using the <code class="docutils literal notranslate"><span class="pre">nightly</span></code> tag, specify a release tag.
You can find the release tags and more information on the <a class="reference external" href="https://catalog.ngc.nvidia.com/orgs/nvidia/teams/merlin/containers/merlin-tensorflow">Merlin TensorFlow</a> container page.</p>
</div></blockquote>
<p>To run the example notebooks using a container, do the following:</p>
<ol class="arabic">
<li><p>After you pull the container, launch it by running the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--gpus<span class="w"> </span>all<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>-p<span class="w"> </span><span class="m">8001</span>:8001<span class="w"> </span>-p<span class="w"> </span><span class="m">8002</span>:8002<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>&lt;path<span class="w"> </span>to<span class="w"> </span>your<span class="w"> </span>data&gt;:/workspace/data/<span class="w"> </span>--ipc<span class="o">=</span>host<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>nvcr.io/nvidia/merlin/merlin-tensorflow:nightly<span class="w"> </span>/bin/bash
</pre></div>
</div>
<p>You can remove the <code class="docutils literal notranslate"><span class="pre">--gpus</span> <span class="pre">all</span></code> flag to run the example on CPU.</p>
<p>The container opens a shell when the run command execution is complete.
Your shell prompt should look similar to the following example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>root@2efa5b50b909:
</pre></div>
</div>
</li>
<li><p>Start JupyterLab by running the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jupyter-lab<span class="w"> </span>--allow-root<span class="w"> </span>--ip<span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="w"> </span>--NotebookApp.token<span class="o">=</span><span class="s1">&#39;&lt;password&gt;&#39;</span>
</pre></div>
</div>
<p>View the messages in your terminal to identify the URL for JupyterLab.
The messages in your terminal should show lines like the following example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Or copy and paste one of these URLs:
http://2efa5b50b909:8888/lab?token=9b537d1fda9e4e9cadc673ba2a472e247deee69a6229ff8d
or http://127.0.0.1:8888/lab?token=9b537d1fda9e4e9cadc673ba2a472e247deee69a6229ff8d
</pre></div>
</div>
</li>
<li><p>Open a browser and use the <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> URL provided in the messages from JupyterLab.</p></li>
<li><p>After you log in to JupyterLab, navigate to the <code class="docutils literal notranslate"><span class="pre">/Merlin/examples/Building-and-deploying-multi-stage-RecSys/</span></code> directory and execute the example notebooks.</p></li>
</ol>
</section>
<div class="toctree-wrapper compound">
</div>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../getting-started-movielens/04-Triton-Inference-with-TF.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Serve Recommendations from the TensorFlow Model</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="01-Building-Recommender-Systems-with-Merlin.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Building Intelligent Recommender Systems with Merlin</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By NVIDIA<br/>
  
      &copy; Copyright 2022, NVIDIA.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>